# 詳細ワークフロー

このドキュメントでは、GitHub Issue発行から成果物のPushまでの各ステップにおける詳細な処理内容、生成アセット、使用ツール、自己チェック項目について解説します。

## 目次
1. [ステップ1: Issueによるトリガー](#ステップ1-issueによるトリガー)
2. [ステップ2: テキストコンテンツ生成](#ステップ2-テキストコンテンツ生成)
3. [ステップ3: 音声・環境音生成](#ステップ3-音声環境音生成)
4. [ステップ4: 画像コンテンツ生成](#ステップ4-画像コンテンツ生成)
5. [ステップ5: 自己チェックと成果物Push](#ステップ5-自己チェックと成果物push)

---

### ステップ1: Issueによるトリガーとエージェント起動

- **処理内容**: ユーザーがリポジトリに定義されたIssueテンプレートを元にIssueを作成します。その後、Web UIを通じてJulesエージェントを起動し、対象のIssueを処理させます。
- **使用ツール**: GitHub Issues, Web UI
- **生成アセット**: なし

### ステップ2: テキストコンテンツ生成

- **処理内容**: JulesエージェントがIssueの内容を解釈し、内部のGeminiモデルを利用して動画の骨子となるテキストベースのアセットを生成します。
- **使用ツール**: Jules (内部のGeminiモデルを含む)
- **生成アセット**:
    - **台本 (`script.txt`)**: Issueのテーマに基づいた動画の台本。
    - **タイトル (`title.txt`)**: SEOと視聴者の興味を引く動画タイトル。
    - **概要 (`summary.txt`)**: YouTubeの概要欄に記載する説明文。
    - **立ち絵プロンプト (`image_prompt.txt`)**: 立ち絵画像を生成するための英語プロンプト。

### ステップ3: 音声・環境音生成

- **処理内容**: テキストコンテンツを元に、音声関連のアセットを生成します。
- **使用ツール**:
    - **CoeFont**: 台本テキストを元に、感情表現などを加味した日本語ナレーションを生成します。
    - **Stable Audio**: 動画の雰囲気に合う環境音（BGMや効果音）を生成します。
- **生成アセット**:
    - **ナレーション音声 (`voice.wav`)**: 台本を読み上げた音声ファイル。
    - **環境音 (`ambience.mp3`)**: 動画の背景で流すBGMや環境音。

### ステップ4: 画像コンテンツ生成

- **処理内容**: テキストやプロンプトを元に、視覚的なアセットを生成します。特にサムネイルは複数の素材を合成して作成されます。
- **使用ツール**:
    - **Jules (内部の画像生成モデルを含む)**: `image_prompt.txt`の内容を元に、キャラクターの立ち絵画像を生成します。
    - **ImageMagick**: 背景画像、立ち絵、テキストを合成し、最終的なサムネイルを生成します。詳細は `02_thumbnail.md` を参照。
- **生成アセット**:
    - **立ち絵 (`character.png`)**: 背景が透過されたキャラクター画像。
    - **サムネイル (`thumbnail.jpg`)**: 最終的に動画に設定するサムネイル画像。

### ステップ5: 自己チェックと成果物Push

- **処理内容**: すべてのアセットが生成された後、規定のフォーマットやサイズに準拠しているか自動で検証します。問題がなければ、Git LFSを用いてリポジトリにPushします。
- **使用ツール**: Git LFS, Bashスクリプト
- **生成アセット**:
    - **メタデータ (`metadata.json`)**: 生成した全アセットのファイルパス、サイズ、生成日時などの情報を記録したJSONファイル。
- **自己チェックの条件**:
    - **テキスト**:
        - `script.txt`: 50文字以上であること。
        - `title.txt`: 5文字以上50文字以内であること。
    - **音声**:
        - `voice.wav`: 形式がWAVであること。再生時間が5秒以上であること。
        - `ambience.mp3`: 形式がMP3であること。再生時間が10秒以上であること。
    - **画像**:
        - `character.png`: 形式がPNGであり、背景が透過されていること。解像度が 512x512 以上であること。
        - `thumbnail.jpg`:
            - 形式がJPGであること。
            - 解像度が 1280x720 であること。
            - ファイルサイズが 2MB 未満であること。
    - **メタデータ**:
        - `metadata.json`: JSONとして有効な形式であること。必須キーがすべて存在すること。
